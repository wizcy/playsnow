# PRD：流沙俄罗斯方块（Sand Tetris）

> 来源灵感：微信文章《俄罗斯方块谁不会做……啊？流沙版？》— 亿元程序员
> 创建时间：2026-02-27
> 负责人：毛毛

---

## 一、产品概述

在经典俄罗斯方块基础上加入"流沙物理"机制：方块落地后不是整块固定，而是**像沙粒一样散开、堆积、流动**，形成自然的沙堆形态。消行逻辑保留，但判定基于沙粒密度而非整行填满。

核心差异点：
- 普通俄罗斯方块：方块落地 → 整块固定 → 满行消除
- 流沙版：方块落地 → 分解为沙粒 → 沙粒物理下落堆积 → 满行消除

---

## 二、核心玩法

### 2.1 沙粒物理规则
- 方块接触地面或其他沙粒时，立即分解为单个像素/沙粒
- 每帧沙粒按以下优先级移动：
  1. 正下方为空 → 直接下落
  2. 左下方为空 → 向左下滑落
  3. 右下方为空 → 向右下滑落
  4. 都不为空 → 静止堆积
- 沙粒有轻微随机扩散（±1格概率 30%），模拟真实流沙感

### 2.2 消行规则
- 某一行沙粒密度 ≥ 90% 时触发消行
- 消行后上方沙粒重新受重力影响，自然下落填充空隙
- 连消奖励保留（2连=1.5x，3连=2x，4连=3x）

### 2.3 方块形状
- 保留标准7种俄罗斯方块形状（I/O/T/S/Z/J/L）
- 每种形状对应不同颜色的沙粒

### 2.4 难度递进
- 每消10行，方块下落速度+10%
- 沙粒扩散范围随等级增加（高等级沙粒更"活跃"）

---

## 三、界面设计

- 游戏区域：10×20格（标准俄罗斯方块尺寸）
- 沙粒大小：4×4 像素（每格由4×4沙粒组成）
- 右侧面板：下一个方块预览、当前分数、等级、消行数
- 背景：深色沙漠风格，配合沙粒视觉效果
- 移动端适配：触摸左滑/右滑移动，上滑加速，点击旋转

---

## 四、技术要求

- 纯 HTML5 + Canvas，零依赖
- 沙粒模拟用 TypedArray（Uint8Array）存储网格状态，性能优先
- 目标帧率：60fps（沙粒数量上限 ~8000 粒）
- 文件结构与现有游戏一致：`games/sand-tetris/index.html`

---

## 五、验收标准

- [ ] 方块落地后正确分解为沙粒并物理堆积
- [ ] 消行逻辑正确（≥90% 密度触发）
- [ ] 消行后沙粒自然下落填充
- [ ] 移动端触摸操作流畅
- [ ] 60fps 无卡顿（Chrome/Safari）
- [ ] 游戏结束检测正确（沙粒堆到顶部）
- [ ] 分数/等级/消行数正确计算

---

## 六、上线要求

- 添加到 `src/games.ts` 游戏列表
- 封面图：沙粒堆积效果截图，尺寸 400×300
- 标题（zh）：流沙俄罗斯方块
- 标题（en）：Sand Tetris
- 描述（zh）：经典俄罗斯方块的流沙变体，方块落地后化为沙粒自然堆积
- 描述（en）：A physics-based Tetris variant where blocks dissolve into sand particles
- 标签：puzzle, physics, classic
